<div class="buttons">
  <button class="button print" (click)="printThisPage()">Print</button>
  <button class="button export" (click)="exportToJson()">Save</button>
  <button (click)="saveToFirestore()">Save (Cloud)</button>
  <input type="file" (change)="importJson($event)" style="display: none" #fileInput />
  <button class="button export" (click)="fileInput.click()">Open</button>
  <button class="button font" (click)="increaseFontSize()">Font+</button>
  <button class="button font" (click)="decreaseFontSize()">Font-</button>
  <button class="button edit" (click)="openEditModal()">–ü–æ–ø–æ–ª–Ω–∏</button>
  <button class="invisible"></button>
</div>

<div class="invoice">
  <div class="elementA">
    <div class="invoice-header">
      <img *ngIf="company?.logoUrl" [src]="company.logoUrl" alt="Company Logo" class="logo" />
      <h2>{{ company?.name }}</h2>
      <div class="box-line"></div>
    </div>

    <div class="invoice-company-info">
      <div>
        <span>{{ company?.address }}</span> *
        <span>–¢–µ–ª.: {{ company?.phone }}</span>
      </div>
      <div>
        <span>–ñ–∏—Ä–æ —Å–º–µ—Ç–∫–∞: {{ company?.accountNo }}</span> *
        <span>–ë–∞–Ω–∫–∞: {{ company?.bank }}</span> *
        <span>–ï–î–ë: {{ company?.EDB }}</span>
      </div>
      <div>{{ company?.email }}</div>
    </div>

    <div class="pre-main-content">
      <div class="date-invoice-number">
        <div class="date-value">
          <div class="date">
            <span class="bold">–î–∞—Ç—É–º</span>
            <span>{{ datum | date: "dd/MM/yyyy" }}</span>
          </div>
          <div class="value">
            <span class="bold">–í–∞–ª—É—Ç–∞</span>
            <span>{{ valuta | date: "dd/MM/yyyy" }}</span>
          </div>
        </div>
        <div class="invoice-number">
          <h2 class="uppercase">{{ fakturaTip }}</h2>
          <h2>–±—Ä–æ—ò: {{ fakturaBroj }}</h2>
        </div>
      </div>

      <!-- üîΩ NEW CLIENT PICKER BLOCK -->
      <div class="client-picker">
        <mat-form-field appearance="outline" style="max-width:420px; width:100%;">
          <mat-label>–û–¥–±–µ—Ä–∏ –∫–ª–∏–µ–Ω—Ç</mat-label>
          <input
            type="text"
            matInput
            [formControl]="clientCtrl"
            [matAutocomplete]="autoClients"
            placeholder="–ü–æ—á–Ω–∏ –¥–∞ –∫—É—Ü–∞—à –∏–º–µ..."
          />
          <mat-autocomplete
            #autoClients="matAutocomplete"
            [displayWith]="displayClient"
            (optionSelected)="onSelectClient($event.option.value)">
            <mat-option *ngFor="let c of (clientOptions$ | async)" [value]="c">
              {{ c.name }} <small *ngIf="c.taxId">&nbsp;‚Äî {{ c.taxId }}</small>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
        <button type="button" (click)="addQuickClient()">+ –ù–æ–≤ –∫–ª–∏–µ–Ω—Ç</button>
      </div>
      <!-- üîº END CLIENT PICKER -->

      <div class="invoiced-company">
        <h2>{{ companyTitle }}</h2>
        <p>{{ companyAddress }}</p>
        <p>{{ companyCity }}</p>
        <p *ngIf="companyID">–î–∞–Ω–æ—á–µ–Ω –ë—Ä–æ—ò (–ï–ú–ë–ì): {{ companyID }}</p>
      </div>
    </div>

    <br />
    <div class="addButton">
      <button mat-button class="add-button" (click)="openEntryModal()">
        –î–æ–¥–∞—ò
      </button>
    </div>

    <div class="invoice-content">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>–†.–±</th>
            <th>–û–ø–∏—Å</th>
            <th>–ï –ú</th>
            <th>–ö–æ–ª–∏—á–∏–Ω–∞</th>
            <th>–¶–µ–Ω–∞ –±–µ–∑ –¥–∞–Ω–æ–∫</th>
            <th>–†–∞–±–∞—Ç %</th>
            <th>–†–∞–±–∞—Ç</th>
            <th>–î–î–í %</th>
            <th>–ò–∑–Ω–æ—Å —Å–æ –î–î–í</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of items; let i = index">
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ i + 1 }}.</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.opis }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.em }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.kolicina | number: "1.2-2" }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.cenaBezDanok | number: "1.2-2" }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.rabatProcent }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ cenaSoPresmetanRabat(item) | number: "1.2-2" }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ item.ddv }}</td>
            <td [style.font-size.px]="currentFontSize" [style.padding.px]="paddingSize">{{ cenaSoDDV(item) | number: "1.2-2" }}</td>
            <td class="deleteEntry">
              <button mat-icon-button (click)="removeItem(i)"><mat-icon>delete</mat-icon></button>
              <button mat-icon-button (click)="openEntryModal(item)"><mat-icon>edit</mat-icon></button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="company?.settings?.showTaxCategories" class="invoice-total">
        <div class="invoice-total-titles">
          <div>–¢–∞—Ä–∏—Ñ–∞</div>
          <div>–ò–∑–Ω–æ—Å –±–µ–∑ –î–î–í</div>
          <div>–î–î–í</div>
          <div>–ò–∑–Ω–æ—Å —Å–æ –î–î–í</div>
        </div>
        <div class="invoice-total-values" *ngFor="let summary of summaryData">
          <div>{{ summary.ddvTarifa }}%</div>
          <div>{{ summary.iznosBezDDV | number: "1.2-2" }}</div>
          <div>{{ summary.vkupnoDDV | number: "1.2-2" }}</div>
          <div>{{ summary.iznosSoDDV | number: "1.2-2" }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="elementB">
    <div class="invoice-total-down">
      <div class="slobodenOpis">
        <span class="zabeleshkaHide">–ó–∞–±–µ–ª–µ—à–∫–∞: </span>
        <input matInput [(ngModel)]="slobodenOpis" class="slobodenOpisInput" name="slobodenOpis" />
      </div>
      <div class="totals">
        <div class="down-first">
          <span>–ò–∑–Ω–æ—Å –±–µ–∑ –î–î–í:</span>
          <span>–î–î–í +</span>
          <span>–í–∫—É–ø–µ–Ω –∏–∑–Ω–æ—Å —Å–æ –î–î–í</span>
        </div>
        <div class="down-second">
          <span>{{ vkupenIznosBezDDV | number: "1.2-2" }}</span>
          <span>{{ vkupnoDDV | number: "1.2-2" }}</span>
          <span>{{ vkupenIznosBezDDV + vkupnoDDV | number: "1.2-2" }}</span>
        </div>
      </div>
    </div>

    <div class="invoice-total-payment">
      <div class="payment-first">
        <span>–ó–∞ –Ω–∞–ø–ª–∞—Ç–∞</span>
      </div>
      <div class="payment-second">
        <span><b>{{ vkupenIznosBezDDV + vkupnoDDV | number: "1.2-2" }}</b></span>
      </div>
    </div>

    <div class="declarations">
      <button class="toggleButton" (click)="toggleNoteVisibility()">–î–∞–Ω–æ—á–Ω–∞ –æ–±–≤—Ä—Å–∫–∞</button>
      <p *ngIf="isNoteVisible">
        –ù–∞–ø–æ–º–µ–Ω–∞: –ü—Ä–µ–Ω–µ—Å—É–≤–∞—ö–µ –Ω–∞ –¥–∞–Ω–æ—á–Ω–∞ –æ–±–≤—Ä—Å–∫–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —á–ª–µ–Ω 32–∞, <br />
        —Å—Ç–∞–≤ 1, —Ç–æ—á–∫–∞ 1 –∏ —á–ª–µ–Ω 53 —Å—Ç–∞–≤ 6 –æ–¥ –ó–∞–∫–æ–Ω –∑–∞ –î–î–í <br />
        –ó–∞ –Ω–µ–Ω–∞–≤—Ä–µ–º–µ–Ω–æ –ø–ª–∞—ú–∞—ö–µ —Å–µ –ø—Ä–µ—Å–º–µ—Ç—É–≤–∞ –∑–∞–∫–æ–Ω—Å–∫–∞ –∑–∞—Ç–µ–∑–Ω–∞ –∫–∞–º–∞—Ç–∞ <br />
      </p>
      <br />
      <p [ngClass]="{ 'hidden-on-print': soZborovi === '' }">
        –°–æ –∑–±–æ—Ä–æ–≤–∏: <span class="print-text">{{ soZborovi }}</span>
        <input class="soZboroviInput" type="text" [(ngModel)]="soZborovi" />
      </p>
    </div>

    <div class="signatures">
      <div class="signatures-left">
        <div>________________________</div>
        <p>–ü–†–ò–ú–ò–õ</p>
      </div>
      <div class="signatures-right">
        <p>
          –õ–∏—Ü–µ —Å–æ –æ–≤–ª–∞—Å—Ç—É–≤–∞—ö–µ –∑–∞ –ø–æ—Ç–ø–∏—à—É–≤–∞—ö–µ —Ñ–∞–∫—Ç—É—Ä–∏: <br />
          {{ company?.ownerName }}
        </p>
        <div></div>
      </div>
    </div>
  </div>
</div>
